# Лето в деревне всегда такое веселое время
# Я обожаю гулять по парку вечером
# Моя мама готовит вкусный борщ на обед
# Завтра мы поедем на дачу с друзьями
# Папа купил новую машину красного цвета
# Сегодня дождь идет с самого утра
# Я учусь в университете на втором курсе
# Кот сидит на подоконнике и смотрит в окно
# Мы часто играем в футбол на стадионе
# Вечером мы всей семьей смотрим кино
# Завтра будет праздник в нашем городе
# Я купила себе новое платье на лето
# На выходных поедем на море отдыхать
# Моя сестра учится играть на гитаре
# Папа и я построили скворечник для птиц
# Осенью листья становятся желтыми и красными
# Мы любим проводить время на природе
# Я записался в спортивную секцию по плаванию
# Утром я бегаю в парке рядом с домом
# Собака гуляет со мной каждый вечер
# Мы собираемся на пикник в эти выходные
# У бабушки в саду растут красивые цветы
# Я мечтаю посетить разные страны мира
# Мы купили билеты на концерт любимой группы
# На обед я приготовил спагетти с соусом
# Мой друг занимается фотографией и рисованием
# Сегодня в школе был интересный урок химии
# Мы часто ходим в кафе на центральной улице
# Зимой мы катаемся на лыжах и санках
# Я люблю читать книги про приключения
# Мама испекла вкусный пирог с яблоками
# Утром я пью кофе с молоком и сахаром
# Мы поехали на экскурсию в музей истории
# Сегодня на улице тепло и солнечно
# Я играю на пианино уже три года
# Мы посетили выставку современного искусства
# Вчера мы были в зоопарке с детьми
# Я учусь водить машину на курсах
# Сегодня у меня день рождения
# Мы часто ходим в кино на новые фильмы
# Мой брат любит рисовать пейзажи
# Папа чинит велосипед в гараже
# Мы ездили на рыбалку с дедушкой
# Я готовлю ужин для всей семьи
# В нашем дворе много деревьев и цветов
# Мы пошли на ярмарку в центр города
# Сегодня будет футбольный матч на стадионе
# Я занимаюсь йогой по утрам
# Мы поехали на природу с палатками
# Папа купил новый телевизор домой
# Я люблю готовить итальянские блюда
# Мы гуляем по набережной каждый вечер
# Моя сестра поет в школьном хоре
# У нас в саду растут клубника и малина
# Мы ходим в бассейн каждый выходной
# Сегодня мы идем на выставку кошек
# Я занимаюсь спортом в тренажерном зале
# Мы поехали на велосипедах в парк
# Мама купила новый сервиз на кухню
# Мы любим играть в настольные игры
# Сегодня мы пошли в театр на спектакль
# Я записался на курсы английского языка
# Мы часто ходим на концерты классической музыки
# Папа построил беседку в нашем саду
# Мы собираем грибы в лесу осенью
# Моя сестра занимается танцами
# Сегодня мы идем в цирк с друзьями
# Я люблю рисовать пейзажи и портреты
# Мы поехали кататься на лошадях
# Мама печет пироги каждое воскресенье
# Мы ходим в лес за ягодами и грибами
# Сегодня у нас в школе праздник
# Я купила новые кроссовки для бега
# Мы собираемся поехать в горы летом
# Папа учит меня водить машину
# Сегодня вечером мы пойдем в кафе
# Я люблю ездить на велосипеде по городу
# Мы поехали на дачу на выходные
# Папа делает ремонт в квартире
# Сегодня я приготовил ужин для всей семьи
# Мы пошли на прогулку в лес
# Я записался на курсы фотографии
# Мы поехали в зоопарк с детьми
# Мама купила новую мебель для гостиной
# Мы часто ходим в парк с собакой
# Сегодня будет интересная лекция в университете
# Я учу французский язык самостоятельно
# Мы поехали на экскурсию по городу
# Моя сестра учится играть на скрипке
# Мы любим ходить в музей искусств
# Сегодня у нас будет пикник на природе
# Я играю в шахматы с дедушкой
# Мы поехали в деревню на выходные
# Мама готовит обед для всей семьи
data = """
Мы собираемся всей семьей поехать на дачу на выходные
Папа строит новый дом на нашем загородном участке
Сегодня на улице светит солнце и очень тепло
Я люблю проводить время за чтением интересных книг
Мы часто играем в настольные игры с друзьями
На выходных поедем на экскурсию в старинный замок
Моя сестра учится играть на фортепиано у преподавателя
Мы с друзьями собрались на пикник у озера
Сегодня у нас в школе проходит спортивное мероприятие
Я обожаю ездить на велосипеде по лесным тропинкам
Вечером мы всей семьей смотрим фильм по телевизору
Папа купил новый набор инструментов для ремонта
Мы собираемся на выставку современного искусства
Сегодня мы идем в театр на премьеру спектакля
Я учусь готовить новые блюда по рецептам из интернета
Мы часто гуляем по парку рядом с нашим домом
Моя сестра поет в хоре и участвует в концертах
Сегодня я купил новую книгу о путешествиях по миру
Мы любим ходить на концерты классической музыки
Папа и я строим домик для птиц в саду
Мы собираем грибы и ягоды в лесу каждое лето
Сегодня у нас в школе проводится день здоровья
Я обожаю кататься на лыжах зимой в горах
Мы часто проводим выходные на даче с друзьями
Папа ремонтирует нашу старую машину в гараже
Сегодня мы идем в цирк на представление с акробатами
Мама печет пироги с яблоками и корицей каждый воскресенье
Мы гуляем по набережной и смотрим на закат
Сегодня у нас в школе проходит урок рисования на свежем воздухе
Я люблю фотографировать природу и животных
Мы собираемся поехать на рыбалку на озеро с друзьями
Папа установил новую беседку в саду для семейных посиделок
Мы пошли на ярмарку и купили много интересных вещей
Сегодня я записался на курсы программирования
Мы часто проводим вечера за настольными играми
Моя сестра учится играть на гитаре и сочиняет песни
Сегодня мы идем в кино на новый фильм
Я занимаюсь спортом в тренажерном зале три раза в неделю
Мы часто ходим в бассейн и плаваем вместе
Папа построил новый гараж для машины и инструментов
Сегодня у нас будет пикник на берегу реки
Я люблю готовить новые рецепты и угощать друзей
Мы поехали на велосипедах по живописным местам
Мама купила новые обои для нашей гостиной
Мы собираемся на каток покататься на коньках
Сегодня у нас в школе проходит день творчества
Я обожаю читать книги о приключениях и фантастике
Мы часто ходим в лес за грибами и ягодами
Папа купил новую лодку для рыбалки на озере
Сегодня мы идем на концерт любимой группы
Я люблю ездить на машине по загородным дорогам
Мы гуляем по лесу и наслаждаемся природой
Моя сестра учится танцевать в студии балета
Мы поехали на экскурсию в древний замок
Сегодня у нас в школе проходит день науки
Я занимаюсь йогой и медитацией каждый день
Мы часто проводим время в парке аттракционов
Папа ремонтирует старый велосипед в гараже
Сегодня мы идем на выставку цветов в ботанический сад
Я люблю рисовать пейзажи и натюрморты акварелью
Мы собираемся на пикник в загородный лес
Мама готовит вкусный ужин для всей семьи
Мы часто ходим в зоопарк и смотрим на животных
Сегодня у нас в школе проходит день экологии
Я обожаю путешествовать и открывать новые места
Мы собираемся поехать на море на летние каникулы
Папа строит новый сарай для инструментов в саду
Сегодня мы идем на спектакль в местный театр
Я занимаюсь плаванием и участвую в соревнованиях
Мы часто гуляем по старинным улицам нашего города
Моя сестра поет в школьном хоре и выступает на концертах
Мы поехали на экскурсию в исторический музей
Сегодня у нас в школе проходит день искусств
Я люблю кататься на роликах в парке рядом с домом
Мы собираемся на природу с палатками на выходные
Папа чинит старую мебель и придает ей новый вид
Сегодня мы идем на футбольный матч с друзьями
Я люблю смотреть фильмы и обсуждать их с друзьями
Мы часто ходим в библиотеку и читаем книги вместе
Моя сестра учится играть на скрипке у известного педагога
Мы поехали на экскурсию в старинный монастырь
Сегодня у нас в школе проводится день здоровья и спорта
Я занимаюсь бегом по утрам и чувствую себя отлично
Мы гуляем по пляжу и собираем красивые ракушки
Папа купил новый мангал для шашлыков на даче
Сегодня мы идем на праздник в центре города
Я люблю рисовать и посещаю художественную школу
Мы часто ходим на каток и катаемся на коньках вместе
Моя сестра участвует в танцевальных конкурсах и фестивалях
Мы поехали на экскурсию по старинным улочкам города
Сегодня у нас в школе проходит день дружбы
Я занимаюсь музыкой и играю на фортепиано каждый день
"""

from speller.prediction.chat_gpt_client import ChatGPTClient
from speller.prediction.chat_gpt_predictor import ChatGptPredictor
from speller.prediction.dictionary import Dictionary
from speller.prediction.suggestions_getter import SuggestionsGetter
from speller.prediction.t9_predictor import T9_CHARS, T9Predictor
from speller.secrets_settings import ChatGPTSecretsSettings
from speller.settings import ChatGPTSettings, DictionarySettings


T9_CHARS = {
    'а': 0, 'б': 0, 'в': 0, 'г': 0,
    'д': 1, 'е': 1, 'ж': 1, 'з': 1,
    'и': 2, 'й': 2, 'к': 2, 'л': 2,
    'м': 3, 'н': 3, 'о': 3, 'п': 3,
    'р': 4, 'с': 4, 'т': 4, 'у': 4,
    'ф': 5, 'х': 5, 'ц': 5, 'ч': 5,
    'ш': 6, 'щ': 6, 'ъ': 6, 'ы': 6,
    'ь': 7, 'э': 7, 'ю': 7, 'я': 7,
}

dictionary = Dictionary(DictionarySettings())

def words_to_t9_nums(words: list[str]) -> list[int]:
    return [[T9_CHARS[char] for char in word] for word in words]

REGULAR_CHARS = {char : i for i, char in enumerate(sorted(T9_CHARS.keys()))}

def words_to_regular_nums(words: list[str]) -> list[int]:
    return [[REGULAR_CHARS[char] for char in word] for word in words]



texts = list(line.lower() for line in data.splitlines() if line)


counts_t9 = []
counts_regular = []

suggestion_getter = SuggestionsGetter(
    T9Predictor(
        dictionary,
    ),
    ChatGptPredictor(
        ChatGPTClient(
            ChatGPTSettings(),
            ChatGPTSecretsSettings()
        )
    ),
)

for text in texts[:20]:
    words = text.lower().split()
    text_t9 = words_to_t9_nums(words)
    text_regular = words_to_regular_nums(words)

    counts_regular.append(len(text))

    count = 0
    text = ""
    prefix = []
    suggestions = []
    for word_t9, word in zip(text_t9, words):
        for i, char in zip(word_t9, word):
            if word in suggestions:
                if prefix:
                    print(f"choose T9 suggestion {word}")
                    pass
                else:
                    print(f"choose GPT suggestion {word}")
                if text: text += " "
                text += word
                prefix = []
                count += 1 # choose t9 suggestion
                suggestions = suggestion_getter.get_suggestions(text, prefix, 6)
                break
            else:
                # print(f"choose t9 {i}(for char '{char}')")
                pass
                prefix.append(i)
                count += 1 # choose t9
                suggestions = suggestion_getter.get_suggestions(text, prefix, 6)

        # print(f"{text=}, {prefix=}, {word=}, {suggestions=}")
        if len(prefix) == len(word):
            if word in suggestions:
                print(f"choose T9 suggestion {word}")
                if text: text += " "
                text += word
                prefix = []
                count += 1 # choose gpt suggestion

                suggestions = suggestion_getter.get_suggestions(text, prefix, 6)
            else:
                raise RuntimeError(f'Cant find word {word} in suggestions {suggestions} but prefix is done')

    counts_t9.append(count)

steps_per_char_regular = [count / len(text) for text, count in zip(texts, counts_regular)] 
steps_per_char_t9 = [count / len(text) for text, count in zip(texts, counts_t9)]

print(f"Regular steps/char, mean: {sum(steps_per_char_regular) / len(steps_per_char_regular)}")
print(f"T9 steps/char, mean: {sum(steps_per_char_t9) / len(steps_per_char_t9)}")
